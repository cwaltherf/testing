package com.rundeck.selenium.test.common;// Generated by Selenium IDE
import com.rundeck.selenium.test.setup.FrameworkSetup;
import org.junit.Test;
import org.junit.Before;
import org.junit.After;
import static org.junit.Assert.*;
import static org.hamcrest.CoreMatchers.is;
import static org.hamcrest.core.IsNot.not;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.remote.RemoteWebDriver;
import org.openqa.selenium.remote.DesiredCapabilities;
import org.openqa.selenium.Dimension;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import static org.junit.Assert.assertThat;
import static org.hamcrest.CoreMatchers.is;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.Alert;
import org.openqa.selenium.Keys;
import java.util.*;
import java.net.MalformedURLException;
import java.net.URL;

public class CreatejobTest extends FrameworkSetup {

    @Test
    public void createjob() {
        login("http://localhost:4440","admin","admin");
        createProject("test", null);

        //create child job - test-job
        driver.findElement(By.id("nav-jobs-link")).click();
        driver.findElement(By.linkText("Create a new Job")).click();
        driver.findElement(By.id("schedJobName")).click();
        driver.findElement(By.id("schedJobName")).sendKeys("test_job");
        driver.findElement(By.linkText("Workflow")).click();
        driver.findElement(By.cssSelector(".list-group-item.add_node_step_type")).click();
        new WebDriverWait(driver, 2).until(ExpectedConditions.visibilityOf(driver.findElement(By.id("adhocRemoteStringField"))));
        driver.findElement(By.id("adhocRemoteStringField")).click();
        driver.findElement(By.id("adhocRemoteStringField")).sendKeys("whoami");
        driver.findElement(By.cssSelector(".btn:nth-child(4)")).click();
        driver.findElement(By.id("Create")).click();

        //create parent job - parent
        driver.findElement(By.id("nav-jobs-link")).click();
        driver.findElement(By.cssSelector(".btn.btn-default.btn-sm.dropdown-toggle")).click();
        driver.findElement(By.partialLinkText("New Job")).click();
        driver.findElement(By.id("schedJobName")).click();
        driver.findElement(By.id("schedJobName")).sendKeys("parent");
        driver.findElement(By.linkText("Workflow")).click();

        //add node step - jobref
        js.executeScript("location.href = \"#addnodestep\";");
        driver.findElement(By.cssSelector(".list-group-item.add_node_step_type:nth-child(5)")).click();
        driver.findElement(By.id("useNameTrue")).click();

        // child job name specification
        WebElement jnf = driver.findElement(By.xpath("//*[starts-with(@id, 'jobNameField')]"));
        jnf.sendKeys("test_job");

        //wait 1 sec to populate UUID field
        try {
            Thread.sleep(1000);                 //1000 milliseconds is one second.
        } catch(InterruptedException ex) {
            Thread.currentThread().interrupt();
        }

        // save the  job reference step.
        driver.findElement(By.className("floatr")).findElement(By.cssSelector(".btn.btn-primary.btn-sm")).click();

        // save the job
        driver.findElement(By.id("Create")).click();


        // click on "Run" button
        driver.findElement(By.id("execFormRunButton")).click();

        deleteProject(true);
        driver.findElement(By.cssSelector(".fa-user")).click();
        driver.findElement(By.linkText("Logout")).click();
    }
}
